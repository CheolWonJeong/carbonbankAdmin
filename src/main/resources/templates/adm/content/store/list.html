<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{adm/layout/admlayour}">
	<th:block layout:fragment="head" th:insert="~{@{/adm/layout/admhead}}"></th:block>

<script type="text/javascript">
	$(function(){ 
	});

	$(document).ready(function(){
		
		// 최초 로딩 시 1페이지 검색
		searchNews(1);

		// 검색 버튼 클릭
		$('#searchBtn').on('click', function() {
		    searchNews(1);
		});

		// 엔터키로 검색
		$('#searchValue').on('keydown', function(event) {
		    if (event.keyCode === 13) {
		        searchNews(1);
		    }
		});		
    	
		function searchNews(pageIdx) {
			console.log("searchNews pageIdx " + pageIdx);
		    var rowPerPage = 10;
		    var param = {
				"searchType" : "TITLE",
		        "searchValue" : $('#searchValue').val(),
		        "pageNo" : pageIdx
		    };

		    $.ajax({
				url : '/adm/store/StoreInfoQueryList',
		        type : 'POST',
		        dataType : 'JSON',
		        cache : false,
		        data : param,
		        success : function(data) {
		            var values = data.rows;
		            var strHtml = "";

		            if (values && values.length > 0) {
		                $.each(values, function(index, value){

		                    strHtml += '<tr id="' + value.storeId + '">';
							strHtml += '    <td>' + value.storeId + '</td>';
		                    strHtml += '    <td><a href ="/adm/store/StoreInfoDesc.do?storeId=' +value.storeId+ '">' +value.storeNm+ '</a></td>';
		                    strHtml += '    <td>' + safeHtml(value.storeAddr) + '</td>';
		                    //strHtml += '    <td>' + safeHtml(value.storeEmail) + '</td>';
		                    strHtml += '    <td>' + value.creDtm + '</td>';
		                    strHtml += '</tr>';

		                });
		            } else {
		                strHtml = '<tr><td colspan="4" class="no_result"><span>검색 결과가 없습니다.</span></td></tr>';
		            }
		            $('#boardTbody1').html(strHtml);

					// 페이징 UI 렌더링
					renderPagination(data.totalPages, data.currentPage);

					// 총 건수 표시
					$('#totalCount').text(data.totalCount);					
		        },
		        error : function() {
		            alert('서비스 장애발생 관리자에게 문의해 주십시요');
		        }
		    });
		}		
        $('#insertBtn').on('click',function(){
            location.href = "/adm/store/StoreInfoIns.do";
        });
        
        //엔터시 검색
        $('#searchValue').on('keydown', function(event, page) {
        	if (event.keyCode != 13) {
        		return;
        	}
        	$("#searchBtn").trigger('click', 1);
        });
		

		function renderPagination(totalPages, currentPage) {
		    var $pagination = $('#pagination');
		    $pagination.empty();

		    if (totalPages <= 1) return; // 1페이지 이하일 때는 표시 안함

		    var html = '<div class="inner"><ul>';

		    // 처음 페이지
		    html += `<li><a href="#" class="page-link" data-page="1" ${currentPage==1?'disabled':''}><i class="iconfont">first_page</i></a></li>`;
		    // 이전 페이지
		    html += `<li><a href="#" class="page-link" data-page="${currentPage-1}" ${currentPage==1?'disabled':''}><i class="iconfont">chevron_left</i></a></li>`;

		    // 페이지 번호 (최대 9개)
		    var start = Math.max(1, currentPage-4);
		    var end = Math.min(totalPages, currentPage+4);
		    for (var i = start; i <= end; i++) {
		        html += `<li><a href="#" class="page-link${i==currentPage?' active':''}" data-page="${i}">${i}</a></li>`;
		    }

		    // 다음 페이지
		    html += `<li><a href="#" class="page-link" data-page="${currentPage+1}" ${currentPage==totalPages?'disabled':''}><i class="iconfont">chevron_right</i></a></li>`;
		    // 마지막 페이지
		    html += `<li><a href="#" class="page-link" data-page="${totalPages}" ${currentPage==totalPages?'disabled':''}><i class="iconfont">last_page</i></a></li>`;
		    html += '</ul></div>';

		    $pagination.html(html);

		    // 페이지 클릭 이벤트
		    $pagination.find('.page-link').not('[disabled]').on('click', function(e){
		        e.preventDefault();
		        var page = parseInt($(this).data('page'));
		        if (!isNaN(page) && page >= 1 && page <= totalPages && page != currentPage) {
		            searchNews(page);
		        }
		    });
		}
		
		function safeHtml(value, defaultValue) {
		    if (value === null || value === undefined || value === "null") {
		        return defaultValue !== undefined ? defaultValue : '';
		    }
		    return value;
		}		
		
    });
</script>

<body>
<div class="adm-wrap">
	<th:block layout:fragment="header" th:insert="~{@{/adm/layout/admheader}}"></th:block>
	
	<div layout:fragment="content">
    <div class="adm-container">
        <header>
            <ul class="top-info">
                <li>
                    <i class="iconfont">account_circle</i><span th:text="${sessInfo.CrbnAdmNm}">홍길동님</span> 님 반갑습니다
                </li>
                <li>
                    <a href="#"><i class="iconfontline">logout</i>로그아웃</a>
                </li>
            </ul>
        </header>

        <!--- content -->
        <div class="adm-content">
            <h2>가맹점 관리</h2>

            <div class="grid-2">
				<div class="t-13 mT10 gray">
				    총 건수 : <span id="totalCount">0</span>건
				    <!--총 건수 : <span th:text="${totalCount}">0</span> 건-->
				</div>
                <div class="t-right">
                    <div class="search-type">
						<input type="text" name="searchValue" id="searchValue" class="input-type1" placeholder="Search" />
						<button type="button" class="btn-search" id="searchBtn">검색</button>						
                    </div>
                </div>
            </div>

            <div class="board-type1 mT10">
                <table>
                    <colgroup>
						<col style="width:15%;" />
						<col style="width:30%;" />
                        <col style="width:40%;" />
                        <!-- <col style="width:15%;" /> -->
                        <col style="width:15%;" />
                    </colgroup>
                    <thead>
                        <tr>
						  <th>아이디</th>
						  <th>상호</th>
			              <th>사업장 주소</th>
			              <!-- <th>이메일</th> -->
			              <th>생성일</th>
                        </tr>
                    </thead>
					<tbody id="boardTbody1">
					</tbody>
                </table>
            </div>

            <div class="f-right mT20">
                <button type="button" class="btn-blue" id="insertBtn">등록</button>
            </div>

			<!-- 페이징 UI 시작 -->
			<div id="pagination" class="page-num mT30"></div>
			<!-- 페이징 UI 끝 -->				

        </div>
        <!---// content -->

        <footer>
            Copyright ⓒ CarbonBank. All Rights Reserved
        </footer>
    </div>

	</div>
</div><!-- //wrap -->
</body>
</html>
